<?xml version="1.0" encoding="UTF-8"?>
<project name="org.netlib" default="default" basedir=".">
	<description>Builds, tests, and runs the project org.netlib.</description>
	<property name="version" value="dev" />
	<!-- REMINDER: When bumping the version value, also bump the value in jni/configure -->
	<import file="nbproject/build-impl.xml"/>
    <!--
      -pre-init:                 called before initialization of project properties
      -post-init:                called after initialization of project properties
      -pre-compile:              called before javac compilation
      -post-compile:             called after javac compilation
      -pre-compile-single:       called before javac compilation of single file
      -post-compile-single:      called after javac compilation of single file
      -pre-compile-test:         called before javac compilation of JUnit tests
      -post-compile-test:        called after javac compilation of JUnit tests
      -pre-compile-test-single:  called before javac compilation of single JUnit test
      -post-compile-test-single: called after javac compilation of single JUunit test
      -pre-jar:                  called before JAR building
      -post-jar:                 called after JAR building
      -post-clean:               called after cleaning build products
    -->
	
	<!--
	  We must delete all the files that are autogenerated.
	-->
	<target name="-post-clean">
		<delete>
			<fileset dir="src/org/netlib/blas/" includes="**/*"/>
			<fileset dir="src/org/netlib/lapack/" includes="**/*"/>
			<fileset dir="src/org/netlib/arpack/" includes="**/*"/>
			<fileset dir="jni/" includes="**org_netlib_*.c"/>
			<fileset dir="jni/" includes="**.o"/>
			<fileset dir="jni/" includes="**.a"/>
			<fileset dir="jni/" includes="**org_netlib_*.h"/>
			<fileset dir="jni/" includes="**Makefile.incl"/>
			<fileset dir="jni/" includes="**.so"/>
			<fileset dir="jni/" includes="**.jnilib"/>
		</delete>
		<delete dir="jni/ARPACK"/>
	</target>
	<target name="generate" depends="compile">
		<!-- Autogenerate the Java and C files -->
		<java fork="yes" classname="org.netlib.generate.JavaGenerator" classpath="${run.classpath}" />
	</target>
	
	<!--
	WARNING: you need to call `ant clean generate compile package` for this to work
	because there is no easy way to tell ant that we really do need the second
	compile task to run.
	-->
	<target name="package" depends="javadoc">
		<!-- TODO: unpack and include the F2J classes -->
		<jar destfile="netlib-java-${version}.jar">
			<fileset dir="build/classes"
             excludes="**org/netlib/generate**" />
		</jar>
		<move file="dist/javadoc" todir="." />
		<zip destfile="netlib-java-${version}.zip">
			<zipfileset dir="." excludes="**/lib/nblibraries-private.properties **/nbproject/private** **/.ant-targets-build.xml dist/** build/** **/*.zip **/.svn** **/jni/*.tar.gz" prefix="netlib-java-${version}" />
		</zip>
		<delete dir="javadoc"/>
	</target>
</project>
